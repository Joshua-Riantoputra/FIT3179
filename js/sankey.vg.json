{
    "$schema": "https://vega.github.io/schema/vega/v5.json",
    "height": 750,
    "width": 1400,
    "data": [
      {
        "name": "rawData",
        "values": [
            {
              "State": "New South Wales",
              "Field": "Agricultural Sciences",
              "Money": 182386
            },
            {
              "State": "Victoria",
              "Field": "Agricultural Sciences",
              "Money": 136537
            },
            {
              "State": "Queensland",
              "Field": "Agricultural Sciences",
              "Money": 189667
            },
            {
              "State": "South Australia",
              "Field": "Agricultural Sciences",
              "Money": 45757
            },
            {
              "State": "Western Australia",
              "Field": "Agricultural Sciences",
              "Money": 53505
            },
            {
              "State": "Tasmania",
              "Field": "Agricultural Sciences",
              "Money": 27562
            },
            {
              "State": "Northern Territory",
              "Field": "Agricultural Sciences",
              "Money": 3961
            },
            {
              "State": "Australian Capital Territory",
              "Field": "Agricultural Sciences",
              "Money": 8576
            },
            {
              "State": "New South Wales",
              "Field": "Biological Sciences",
              "Money": 267676
            },
            {
              "State": "Victoria",
              "Field": "Biological Sciences",
              "Money": 321257
            },
            {
              "State": "Queensland",
              "Field": "Biological Sciences",
              "Money": 243490
            },
            {
              "State": "South Australia",
              "Field": "Biological Sciences",
              "Money": 103877
            },
            {
              "State": "Western Australia",
              "Field": "Biological Sciences",
              "Money": 75184
            },
            {
              "State": "Tasmania",
              "Field": "Biological Sciences",
              "Money": 21896
            },
            {
              "State": "Northern Territory",
              "Field": "Biological Sciences",
              "Money": 5302
            },
            {
              "State": "Australian Capital Territory",
              "Field": "Biological Sciences",
              "Money": 49128
            },
            {
              "State": "New South Wales",
              "Field": "Clinical Sciences",
              "Money": 1089414
            },
            {
              "State": "Victoria",
              "Field": "Clinical Sciences",
              "Money": 1008350
            },
            {
              "State": "Queensland",
              "Field": "Clinical Sciences",
              "Money": 443752
            },
            {
              "State": "South Australia",
              "Field": "Clinical Sciences",
              "Money": 265065
            },
            {
              "State": "Western Australia",
              "Field": "Clinical Sciences",
              "Money": 301736
            },
            {
              "State": "Tasmania",
              "Field": "Clinical Sciences",
              "Money": 27711
            },
            {
              "State": "Northern Territory",
              "Field": "Clinical Sciences",
              "Money": 4640
            },
            {
              "State": "Australian Capital Territory",
              "Field": "Clinical Sciences",
              "Money": 82342
            },
            {
              "State": "New South Wales",
              "Field": "Built Environment and Design",
              "Money": 73555
            },
            {
              "State": "Victoria",
              "Field": "Built Environment and Design",
              "Money": 92104
            },
            {
              "State": "Queensland",
              "Field": "Built Environment and Design",
              "Money": 31333
            },
            {
              "State": "South Australia",
              "Field": "Built Environment and Design",
              "Money": 11502
            },
            {
              "State": "Western Australia",
              "Field": "Built Environment and Design",
              "Money": 32375
            },
            {
              "State": "Tasmania",
              "Field": "Built Environment and Design",
              "Money": 2261
            },
            {
              "State": "Northern Territory",
              "Field": "Built Environment and Design",
              "Money": 220
            },
            {
              "State": "Australian Capital Territory",
              "Field": "Built Environment and Design",
              "Money": 3383
            },
            {
              "State": "New South Wales",
              "Field": "Chemical Sciences",
              "Money": 87695
            },
            {
              "State": "Victoria",
              "Field": "Chemical Sciences",
              "Money": 107712
            },
            {
              "State": "Queensland",
              "Field": "Chemical Sciences",
              "Money": 79735
            },
            {
              "State": "South Australia",
              "Field": "Chemical Sciences",
              "Money": 33819
            },
            {
              "State": "Western Australia",
              "Field": "Chemical Sciences",
              "Money": 22620
            },
            {
              "State": "Tasmania",
              "Field": "Chemical Sciences",
              "Money": 3615
            },
            {
              "State": "Northern Territory",
              "Field": "Chemical Sciences",
              "Money": 335
            },
            {
              "State": "Australian Capital Territory",
              "Field": "Chemical Sciences",
              "Money": 16449
            },
            {
              "State": "New South Wales",
              "Field": "Commerce",
              "Money": 161639
            },
            {
              "State": "Victoria",
              "Field": "Commerce",
              "Money": 124486
            },
            {
              "State": "Queensland",
              "Field": "Commerce",
              "Money": 85798
            },
            {
              "State": "South Australia",
              "Field": "Commerce",
              "Money": 42346
            },
            {
              "State": "Western Australia",
              "Field": "Commerce",
              "Money": 31816
            },
            {
              "State": "Tasmania",
              "Field": "Commerce",
              "Money": 9206
            },
            {
              "State": "Northern Territory",
              "Field": "Commerce",
              "Money": 2624
            },
            {
              "State": "Australian Capital Territory",
              "Field": "Commerce",
              "Money": 10728
            },
            {
              "State": "New South Wales",
              "Field": "Creative Arts and Writing",
              "Money": 40919
            },
            {
              "State": "Victoria",
              "Field": "Creative Arts and Writing",
              "Money": 33707
            },
            {
              "State": "Queensland",
              "Field": "Creative Arts and Writing",
              "Money": 17589
            },
            {
              "State": "South Australia",
              "Field": "Creative Arts and Writing",
              "Money": 6695
            },
            {
              "State": "Western Australia",
              "Field": "Creative Arts and Writing",
              "Money": 9381
            },
            {
              "State": "Tasmania",
              "Field": "Creative Arts and Writing",
              "Money": 2615
            },
            {
              "State": "Northern Territory",
              "Field": "Creative Arts and Writing",
              "Money": 785
            },
            {
              "State": "Australian Capital Territory",
              "Field": "Creative Arts and Writing",
              "Money": 3178
            },
            {
              "State": "New South Wales",
              "Field": "Earth Sciences",
              "Money": 86811
            },
            {
              "State": "Victoria",
              "Field": "Earth Sciences",
              "Money": 71813
            },
            {
              "State": "Queensland",
              "Field": "Earth Sciences",
              "Money": 41573
            },
            {
              "State": "South Australia",
              "Field": "Earth Sciences",
              "Money": 20813
            },
            {
              "State": "Western Australia",
              "Field": "Earth Sciences",
              "Money": 70806
            },
            {
              "State": "Tasmania",
              "Field": "Earth Sciences",
              "Money": 16923
            },
            {
              "State": "Northern Territory",
              "Field": "Earth Sciences",
              "Money": 2197
            },
            {
              "State": "Australian Capital Territory",
              "Field": "Earth Sciences",
              "Money": 38731
            },
            {
              "State": "New South Wales",
              "Field": "Economics",
              "Money": 85354
            },
            {
              "State": "Victoria",
              "Field": "Economics",
              "Money": 96222
            },
            {
              "State": "Queensland",
              "Field": "Economics",
              "Money": 37665
            },
            {
              "State": "South Australia",
              "Field": "Economics",
              "Money": 10445
            },
            {
              "State": "Western Australia",
              "Field": "Economics",
              "Money": 14166
            },
            {
              "State": "Tasmania",
              "Field": "Economics",
              "Money": 4216
            },
            {
              "State": "Northern Territory",
              "Field": "Economics",
              "Money": 840
            },
            {
              "State": "Australian Capital Territory",
              "Field": "Economics",
              "Money": 25965
            },
            {
              "State": "New South Wales",
              "Field": "Education",
              "Money": 98623
            },
            {
              "State": "Victoria",
              "Field": "Education",
              "Money": 112985
            },
            {
              "State": "Queensland",
              "Field": "Education",
              "Money": 62711
            },
            {
              "State": "South Australia",
              "Field": "Education",
              "Money": 14697
            },
            {
              "State": "Western Australia",
              "Field": "Education",
              "Money": 32207
            },
            {
              "State": "Tasmania",
              "Field": "Education",
              "Money": 12732
            },
            {
              "State": "Northern Territory",
              "Field": "Education",
              "Money": 5669
            },
            {
              "State": "Australian Capital Territory",
              "Field": "Education",
              "Money": 18704
            },
            {
              "State": "New South Wales",
              "Field": "Engineering",
              "Money": 513468
            },
            {
              "State": "Victoria",
              "Field": "Engineering",
              "Money": 510555
            },
            {
              "State": "Queensland",
              "Field": "Engineering",
              "Money": 250156
            },
            {
              "State": "South Australia",
              "Field": "Engineering",
              "Money": 87447
            },
            {
              "State": "Western Australia",
              "Field": "Engineering",
              "Money": 142782
            },
            {
              "State": "Tasmania",
              "Field": "Engineering",
              "Money": 9990
            },
            {
              "State": "Northern Territory",
              "Field": "Engineering",
              "Money": 5349
            },
            {
              "State": "Australian Capital Territory",
              "Field": "Engineering",
              "Money": 130724
            },
            {
              "State": "New South Wales",
              "Field": "Environmental Sciences",
              "Money": 117559
            },
            {
              "State": "Victoria",
              "Field": "Environmental Sciences",
              "Money": 110163
            },
            {
              "State": "Queensland",
              "Field": "Environmental Sciences",
              "Money": 140247
            },
            {
              "State": "South Australia",
              "Field": "Environmental Sciences",
              "Money": 30163
            },
            {
              "State": "Western Australia",
              "Field": "Environmental Sciences",
              "Money": 67382
            },
            {
              "State": "Tasmania",
              "Field": "Environmental Sciences",
              "Money": 16607
            },
            {
              "State": "Northern Territory",
              "Field": "Environmental Sciences",
              "Money": 26389
            },
            {
              "State": "Australian Capital Territory",
              "Field": "Environmental Sciences",
              "Money": 22110
            },
            {
              "State": "New South Wales",
              "Field": "Health Sciences",
              "Money": 587197
            },
            {
              "State": "Victoria",
              "Field": "Health Sciences",
              "Money": 456664
            },
            {
              "State": "Queensland",
              "Field": "Health Sciences",
              "Money": 221866
            },
            {
              "State": "South Australia",
              "Field": "Health Sciences",
              "Money": 118140
            },
            {
              "State": "Western Australia",
              "Field": "Health Sciences",
              "Money": 74151
            },
            {
              "State": "Tasmania",
              "Field": "Health Sciences",
              "Money": 23147
            },
            {
              "State": "Northern Territory",
              "Field": "Health Sciences",
              "Money": 14032
            },
            {
              "State": "Australian Capital Territory",
              "Field": "Health Sciences",
              "Money": 44581
            },
            {
              "State": "New South Wales",
              "Field": "History, Heritage and Archaeology",
              "Money": 42399
            },
            {
              "State": "Victoria",
              "Field": "History, Heritage and Archaeology",
              "Money": 30988
            },
            {
              "State": "Queensland",
              "Field": "History, Heritage and Archaeology",
              "Money": 11496
            },
            {
              "State": "South Australia",
              "Field": "History, Heritage and Archaeology",
              "Money": 8854
            },
            {
              "State": "Western Australia",
              "Field": "History, Heritage and Archaeology",
              "Money": 2574
            },
            {
              "State": "Tasmania",
              "Field": "History, Heritage and Archaeology",
              "Money": 3326
            },
            {
              "State": "Northern Territory",
              "Field": "History, Heritage and Archaeology",
              "Money": 139
            },
            {
              "State": "Australian Capital Territory",
              "Field": "History, Heritage and Archaeology",
              "Money": 9086
            },
            {
              "State": "New South Wales",
              "Field": "Human Society",
              "Money": 191655
            },
            {
              "State": "Victoria",
              "Field": "Human Society",
              "Money": 187661
            },
            {
              "State": "Queensland",
              "Field": "Human Society",
              "Money": 87179
            },
            {
              "State": "South Australia",
              "Field": "Human Society",
              "Money": 27462
            },
            {
              "State": "Western Australia",
              "Field": "Human Society",
              "Money": 23274
            },
            {
              "State": "Tasmania",
              "Field": "Human Society",
              "Money": 13266
            },
            {
              "State": "Northern Territory",
              "Field": "Human Society",
              "Money": 10623
            },
            {
              "State": "Australian Capital Territory",
              "Field": "Human Society",
              "Money": 102319
            },
            {
              "State": "New South Wales",
              "Field": "Indigenous Studies",
              "Money": 73685
            },
            {
              "State": "Victoria",
              "Field": "Indigenous Studies",
              "Money": 36342
            },
            {
              "State": "Queensland",
              "Field": "Indigenous Studies",
              "Money": 33733
            },
            {
              "State": "South Australia",
              "Field": "Indigenous Studies",
              "Money": 31042
            },
            {
              "State": "Western Australia",
              "Field": "Indigenous Studies",
              "Money": 39219
            },
            {
              "State": "Tasmania",
              "Field": "Indigenous Studies",
              "Money": 2430
            },
            {
              "State": "Northern Territory",
              "Field": "Indigenous Studies",
              "Money": 5339
            },
            {
              "State": "Australian Capital Territory",
              "Field": "Indigenous Studies",
              "Money": 35808
            },
            {
              "State": "New South Wales",
              "Field": "Computing Science",
              "Money": 193224
            },
            {
              "State": "Victoria",
              "Field": "Computing Science",
              "Money": 217583
            },
            {
              "State": "Queensland",
              "Field": "Computing Science",
              "Money": 70654
            },
            {
              "State": "South Australia",
              "Field": "Computing Science",
              "Money": 31653
            },
            {
              "State": "Western Australia",
              "Field": "Computing Science",
              "Money": 27375
            },
            {
              "State": "Tasmania",
              "Field": "Computing Science",
              "Money": 3649
            },
            {
              "State": "Northern Territory",
              "Field": "Computing Science",
              "Money": 2761
            },
            {
              "State": "Australian Capital Territory",
              "Field": "Computing Science",
              "Money": 83727
            },
            {
              "State": "New South Wales",
              "Field": "Language and Culture",
              "Money": 67904
            },
            {
              "State": "Victoria",
              "Field": "Language and Culture",
              "Money": 63383
            },
            {
              "State": "Queensland",
              "Field": "Language and Culture",
              "Money": 35115
            },
            {
              "State": "South Australia",
              "Field": "Language and Culture",
              "Money": 6988
            },
            {
              "State": "Western Australia",
              "Field": "Language and Culture",
              "Money": 10467
            },
            {
              "State": "Tasmania",
              "Field": "Language and Culture",
              "Money": 3501
            },
            {
              "State": "Northern Territory",
              "Field": "Language and Culture",
              "Money": 498
            },
            {
              "State": "Australian Capital Territory",
              "Field": "Language and Culture",
              "Money": 23156
            },
            {
              "State": "New South Wales",
              "Field": "Law and Legal Studies",
              "Money": 77231
            },
            {
              "State": "Victoria",
              "Field": "Law and Legal Studies",
              "Money": 42517
            },
            {
              "State": "Queensland",
              "Field": "Law and Legal Studies",
              "Money": 28444
            },
            {
              "State": "South Australia",
              "Field": "Law and Legal Studies",
              "Money": 6499
            },
            {
              "State": "Western Australia",
              "Field": "Law and Legal Studies",
              "Money": 2901
            },
            {
              "State": "Tasmania",
              "Field": "Law and Legal Studies",
              "Money": 3360
            },
            {
              "State": "Northern Territory",
              "Field": "Law and Legal Studies",
              "Money": 2185
            },
            {
              "State": "Australian Capital Territory",
              "Field": "Law and Legal Studies",
              "Money": 24030
            },
            {
              "State": "New South Wales",
              "Field": "Mathematical Sciences",
              "Money": 54595
            },
            {
              "State": "Victoria",
              "Field": "Mathematical Sciences",
              "Money": 57199
            },
            {
              "State": "Queensland",
              "Field": "Mathematical Sciences",
              "Money": 28536
            },
            {
              "State": "South Australia",
              "Field": "Mathematical Sciences",
              "Money": 8142
            },
            {
              "State": "Western Australia",
              "Field": "Mathematical Sciences",
              "Money": 20411
            },
            {
              "State": "Tasmania",
              "Field": "Mathematical Sciences",
              "Money": 1403
            },
            {
              "State": "Northern Territory",
              "Field": "Mathematical Sciences",
              "Money": 19
            },
            {
              "State": "Australian Capital Territory",
              "Field": "Mathematical Sciences",
              "Money": 6303
            },
            {
              "State": "New South Wales",
              "Field": "Philosophy and Religious Studies",
              "Money": 28454
            },
            {
              "State": "Victoria",
              "Field": "Philosophy and Religious Studies",
              "Money": 21919
            },
            {
              "State": "Queensland",
              "Field": "Philosophy and Religious Studies",
              "Money": 8125
            },
            {
              "State": "South Australia",
              "Field": "Philosophy and Religious Studies",
              "Money": 1692
            },
            {
              "State": "Western Australia",
              "Field": "Philosophy and Religious Studies",
              "Money": 9962
            },
            {
              "State": "Tasmania",
              "Field": "Philosophy and Religious Studies",
              "Money": 1655
            },
            {
              "State": "Northern Territory",
              "Field": "Philosophy and Religious Studies",
              "Money": 41
            },
            {
              "State": "Australian Capital Territory",
              "Field": "Philosophy and Religious Studies",
              "Money": 2615
            },
            {
              "State": "New South Wales",
              "Field": "Physical Sciences",
              "Money": 154332
            },
            {
              "State": "Victoria",
              "Field": "Physical Sciences",
              "Money": 95971
            },
            {
              "State": "Queensland",
              "Field": "Physical Sciences",
              "Money": 46265
            },
            {
              "State": "South Australia",
              "Field": "Physical Sciences",
              "Money": 12686
            },
            {
              "State": "Western Australia",
              "Field": "Physical Sciences",
              "Money": 23695
            },
            {
              "State": "Tasmania",
              "Field": "Physical Sciences",
              "Money": 1272
            },
            {
              "State": "Northern Territory",
              "Field": "Physical Sciences",
              "Money": 252
            },
            {
              "State": "Australian Capital Territory",
              "Field": "Physical Sciences",
              "Money": 106847
            },
            {
              "State": "New South Wales",
              "Field": "Psychology",
              "Money": 122500
            },
            {
              "State": "Victoria",
              "Field": "Psychology",
              "Money": 156320
            },
            {
              "State": "Queensland",
              "Field": "Psychology",
              "Money": 77240
            },
            {
              "State": "South Australia",
              "Field": "Psychology",
              "Money": 20421
            },
            {
              "State": "Western Australia",
              "Field": "Psychology",
              "Money": 18615
            },
            {
              "State": "Tasmania",
              "Field": "Psychology",
              "Money": 4240
            },
            {
              "State": "Northern Territory",
              "Field": "Psychology",
              "Money": 4211
            },
            {
              "State": "Australian Capital Territory",
              "Field": "Psychology",
              "Money": 11043
            }
           ]
      },
      {
        "name": "nodes",
        "source": "rawData",
        "transform": [
          {
            "type": "filter",
            "expr": "!groupSelector || groupSelector.State == datum.State || groupSelector.Field == datum.Field"
          },
          {"type": "formula", "expr": "datum.State+datum.Field", "as": "key"},
          {"type": "fold", "fields": ["State", "Field"], "as": ["stack", "grpId"]},
          {
            "type": "formula",
            "expr": "datum.stack == 'State' ? datum.State+' '+datum.Field : datum.Field+' '+datum.State",
            "as": "sortField"
          },
          {
            "type": "stack",
            "groupby": ["stack"],
            "sort": {"field": "sortField", "order": "descending"},
            "field": "Money"
          },
          {"type": "formula", "expr": "(datum.y0+datum.y1)/2", "as": "yc"}
        ]
      },
      {
        "name": "groups",
        "source": "nodes",
        "transform": [
          {
            "type": "aggregate",
            "groupby": ["stack", "grpId"],
            "fields": ["Money"],
            "ops": ["sum"],
            "as": ["total"]
          },
          {
            "type": "stack",
            "groupby": ["stack"],
            "sort": {"field": "grpId", "order": "descending"},
            "field": "total"
          },
          {"type": "formula", "expr": "scale('y', datum.y0)", "as": "scaledY0"},
          {"type": "formula", "expr": "scale('y', datum.y1)", "as": "scaledY1"},
          {
            "type": "formula",
            "expr": "datum.stack == 'State'",
            "as": "rightLabel"
          },
          {
            "type": "formula",
            "expr": "datum.total/domain('y')[1]",
            "as": "percentage"
          }
        ]
      },
      {
        "name": "destinationNodes",
        "source": "nodes",
        "transform": [{"type": "filter", "expr": "datum.stack == 'Field'"}]
      },
      {
        "name": "edges",
        "source": "nodes",
        "transform": [
          {"type": "filter", "expr": "datum.stack == 'State'"},
          {
            "type": "lookup",
            "from": "destinationNodes",
            "key": "key",
            "fields": ["key"],
            "as": ["target"]
          },
          {
            "type": "linkpath",
            "orient": "horizontal",
            "shape": "diagonal",
            "sourceY": {"expr": "scale('y', datum.yc)"},
            "sourceX": {"expr": "scale('x', 'State') + bandwidth('x')"},
            "targetY": {"expr": "scale('y', datum.target.yc)"},
            "targetX": {"expr": "scale('x', 'Field')"}
          },
          {
            "type": "formula",
            "expr": "range('y')[0]-scale('y', datum.Money)",
            "as": "strokeWidth"
          },
          {
            "type": "formula",
            "expr": "datum.Money/domain('y')[1]",
            "as": "percentage"
          }
        ]
      }
    ],
    "scales": [ 
      {
        "name": "x",
        "type": "band",
        "range": "width",
        "domain": ["State", "Field"],
        "paddingInner": 0.95
      },
      {
        "name": "y",
        "type": "linear",
        "range": "height",
        "domain": {"data": "nodes", "field": "y1"}
      },
      {
        "name": "color",
        "type": "ordinal",
        "range": "category",
        "domain": {"data": "rawData", "field": "State"}
      },
      {
        "name": "stackNames",
        "type": "ordinal",
        "range": ["Source", "Destination"],
        "domain": ["State", "Field"]
      }
    ],
    "marks": [
      {
        "type": "path",
        "name": "edgeMark",
        "from": {"data": "edges"},
        "clip": true,
        "encode": {
          "update": {
            "stroke": [
              {
                "test": "groupSelector && groupSelector.stack=='State'",
                "field": "Field"
              },
              {"scale": "color", "field": "State"}
            ],
            "strokeWidth": {"field": "strokeWidth"},
            "path": {"field": "path"},
            "strokeOpacity": {
              "signal": "!groupSelector && (groupHover.State == datum.State || groupHover.Field == datum.Field) ? 0.9 : 0.4"
            },
            "zindex": {
              "signal": "!groupSelector && (groupHover.State == datum.State || groupHover.Field == datum.Field) ? 1 : 0"
            },
            "tooltip": {
              "signal": "datum.State + ' on ' + datum.Field + ':  ' + format(datum.Money, ',.0f')"
            }
          },
          "hover": {"strokeOpacity": {"value": 1}}
        }
      },
      {
        "type": "rect",
        "name": "groupMark",
        "from": {"data": "groups"},
        "encode": {
          "enter": {
            "fill": {"scale": "color", "field": "grpId"},
            "width": {"scale": "x", "band": 1}
          },
          "update": {
            "x": {"scale": "x", "field": "stack"},
            "y": {"field": "scaledY0"},
            "y2": {"field": "scaledY1"},
            "fillOpacity": {"value": 1},
            "tooltip": {
              "signal": "datum.grpId + ' Expenditure: ' + format(datum.total, ',.0f')"
            }
          },
          "hover": {"fillOpacity": {"value": 1}}
        }
      },
      {
        "type": "text",
        "from": {"data": "groups"},
        "interactive": false,
        "encode": {
          "update": {
            "x": {
              "signal": "scale('x', datum.stack) + (datum.rightLabel ? bandwidth('x') + 8 : -8)"
            },
            "yc": {"signal": "(datum.scaledY0 + datum.scaledY1)/2"},
            "align": {"signal": "datum.rightLabel ? 'left' : 'right'"},
            "baseline": {"value": "middle"},
            "fontWeight": {"value": "normal"},
            "text": {
              "signal": "abs(datum.scaledY0-datum.scaledY1) > 5 ? datum.grpId : ''"
            }
          }
        }
      },
      {
        "type": "group",
        "data": [
          {
            "name": "dataForShowAll",
            "values": [{}],
            "transform": [{"type": "filter", "expr": "groupSelector"}]
          }
        ],
        "encode": {
          "enter": {
            "xc": {"signal": "width/2"},
            "y": {"value": 30},
            "width": {"value": 80},
            "height": {"value": 30}
          }
        },
        "marks": [
          {
            "type": "group",
            "name": "groupReset",
            "from": {"data": "dataForShowAll"},
            "encode": {
              "enter": {
                "cornerRadius": {"value": 6},
                "fill": {"value": "#f5f5f5"},
                "stroke": {"value": "#000"},
                "strokeWidth": {"value": 2},
                "height": {"field": {"group": "height"}},
                "width": {"field": {"group": "width"}}
              },
              "update": {"opacity": {"value": 1}},
              "hover": {"opacity": {"value": 0.7}}
            },
            "marks": [
              {
                "type": "text",
                "interactive": false,
                "encode": {
                  "enter": {
                    "xc": {"field": {"group": "width"}, "mult": 0.5},
                    "yc": {
                      "field": {"group": "height"},
                      "mult": 0.5,
                      "offset": 2
                    },
                    "align": {"value": "center"},
                    "baseline": {"value": "middle"},
                    "fontWeight": {"value": "normal"},
                    "text": {"value": "Show All"}
                  }
                }
              }
            ]
          }
        ]
      },
      {
        "type": "rect",
        "from": {"data": "nodes"},
        "encode": {
          "enter": {
            "stroke": {"value": "#000"},
            "strokeWidth": {"value": 0},
            "width": {"scale": "x", "band": 1},
            "x": {"scale": "x", "field": "stack"},
            "y": {"field": "y0", "scale": "y"},
            "y2": {"field": "y1", "scale": "y"}
          }
        }
      }
    ],
    "signals": [
      {
        "name": "groupHover",
        "value": {},
        "on": [
          {
            "events": "@groupMark:mouseover",
            "update": "{State:datum.stack=='State' && datum.grpId, Field:datum.stack=='Field' && datum.grpId}"
          },
          {"events": "mouseout", "update": "{}"}
        ]
      },
      {
        "name": "groupSelector",
        "value": false,
        "on": [
          {
            "events": "@groupMark:click!",
            "update": "{stack:datum.stack, State:datum.stack=='State' && datum.grpId, Field:datum.stack=='Field' && datum.grpId}"
          },
          {
            "events": [
              {"type": "click", "markname": "groupReset"},
              {"type": "dblclick"}
            ],
            "update": "false"
          }
        ]
      }
    ],
    "config": {"font": "Poppins", "background": "rgb(245,245,245)"}
}